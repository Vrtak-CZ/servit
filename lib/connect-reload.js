// Generated by CoffeeScript 1.3.3
(function() {
  var hound, socketio;

  hound = require('hound');

  socketio = require('socket.io');

  module.exports = function(_arg) {
    var dir, dog, io, reload, server;
    dir = _arg.dir, server = _arg.server;
    io = socketio.listen(server);
    dog = hound.watch(dir);
    reload = function() {
      return io.sockets.emit('connect-reload');
    };
    dog.on('create', reload);
    dog.on('change', reload);
    return function(_arg1, res, next) {
      var url;
      url = _arg1.url;
      if (url !== '/connect-reload.js') {
        return next();
      }
      res.setHeader('Content-Type', 'text/javascript');
      return res.end("      (function(){        var script = document.createElement('script');        script.src = '/socket.io/socket.io.js';        script.onload = function () {          io.connect('/').on('connect-reload', function () {            document.location.reload(true);          });        };        document.getElementsByTagName('head')[0].appendChild(script);      }());");
    };
  };

}).call(this);
